{"remainingRequest":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/babel-loader/lib/index.js!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/ts-loader/index.js??ref--14-2!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huoxiyi/IdeaProjects/MissuoFrontend/src/views/setmeal/addSetmeal.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/src/views/setmeal/addSetmeal.vue","mtime":1706160678338},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js","mtime":1706160675340},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/babel-loader/lib/index.js","mtime":1706160675266},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/ts-loader/index.js","mtime":1706160677894},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js","mtime":1706160675340},{"path":"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/vue-loader/lib/index.js","mtime":1706160678107}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/defineProperty\"));\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/@babel/runtime-corejs2/helpers/inherits\"));\n\nvar _tslib = require(\"tslib\");\n\nvar _vuePropertyDecorator = require(\"vue-property-decorator\");\n\nvar _index = _interopRequireDefault(require(\"@/components/HeadLable/index.vue\"));\n\nvar _index2 = _interopRequireDefault(require(\"@/components/ImgUpload/index.vue\"));\n\nvar _AddDish = _interopRequireDefault(require(\"./components/AddDish.vue\"));\n\nvar _setMeal = require(\"@/api/setMeal\");\n\nvar _dish = require(\"@/api/dish\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar default_1 =\n/*#__PURE__*/\nfunction (_Vue) {\n  (0, _inherits2.default)(default_1, _Vue);\n\n  function default_1() {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, default_1);\n    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(default_1).apply(this, arguments));\n    _this.value = '';\n    _this.setMealList = [];\n    _this.seachKey = '';\n    _this.dishList = [];\n    _this.imageUrl = '';\n    _this.actionType = '';\n    _this.dishTable = [];\n    _this.dialogVisible = false;\n    _this.checkList = [];\n    _this.ruleForm = {\n      name: '',\n      categoryId: '',\n      price: '',\n      code: '',\n      image: '',\n      description: '',\n      dishList: [],\n      status: true,\n      idType: ''\n    };\n    return _this;\n  }\n\n  (0, _createClass2.default)(default_1, [{\n    key: \"created\",\n    value: function created() {\n      this.getDishTypeList();\n      this.actionType = this.$route.query.id ? 'edit' : 'add';\n\n      if (this.actionType == 'edit') {\n        this.init();\n      }\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                (0, _setMeal.querySetmealById)(this.$route.query.id).then(function (res) {\n                  if (res && res.data && res.data.code === 200) {\n                    _this2.ruleForm = res.data.data;\n                    _this2.ruleForm.status = res.data.data.status == '1';\n                    _this2.ruleForm.price = res.data.data.price; // this.imageUrl = `http://172.17.2.120:8080/common/download?name=${res.data.data.image}`\n\n                    _this2.imageUrl = res.data.data.image;\n                    _this2.checkList = res.data.data.setmealDishes;\n                    _this2.dishTable = res.data.data.setmealDishes.reverse();\n                    _this2.ruleForm.idType = res.data.data.categoryId;\n                  } else {\n                    _this2.$message.error(res.data.msg);\n                  }\n                });\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }()\n  }, {\n    key: \"seachHandle\",\n    value: function seachHandle() {\n      this.seachKey = this.value;\n    } // 获取套餐分类\n\n  }, {\n    key: \"getDishTypeList\",\n    value: function getDishTypeList() {\n      var _this3 = this;\n\n      (0, _dish.getCategoryList)({\n        type: 2,\n        page: 1,\n        pageSize: 1000\n      }).then(function (res) {\n        if (res && res.data && res.data.code === 200) {\n          _this3.setMealList = res.data.data.map(function (obj) {\n            return _objectSpread({}, obj, {\n              idType: obj.id\n            });\n          });\n        } else {\n          _this3.$message.error(res.data.msg);\n        }\n      });\n    } // 通过套餐ID获取菜品列表分类\n    // private getDishList (id:number) {\n    //   getDishListType({id}).then(res => {\n    //     if (res.data.code == 200) {\n    //       const { data } = res.data\n    //       this.dishList = data\n    //     } else {\n    //       this.$message.error(res.data.desc)\n    //     }\n    //   })\n    // }\n    // 删除套餐菜品\n\n  }, {\n    key: \"delDishHandle\",\n    value: function delDishHandle(index) {\n      this.dishTable.splice(index, 1);\n      this.checkList = this.dishTable; // this.checkList.splice(index, 1)\n    } // 获取添加菜品数据 - 确定加菜倒序展示\n\n  }, {\n    key: \"getCheckList\",\n    value: function getCheckList(value) {\n      this.checkList = (0, _toConsumableArray2.default)(value).reverse();\n    } // 添加菜品\n\n  }, {\n    key: \"openAddDish\",\n    value: function openAddDish(st) {\n      this.seachKey = '';\n      this.dialogVisible = true;\n    } // 取消添加菜品\n\n  }, {\n    key: \"handleClose\",\n    value: function handleClose(done) {\n      // this.$refs.adddish.close()\n      this.dialogVisible = false;\n      this.checkList = JSON.parse(JSON.stringify(this.dishTable)); // this.dialogVisible = false\n    } // 保存添加菜品列表\n\n  }, {\n    key: \"addTableList\",\n    value: function addTableList() {\n      this.dishTable = JSON.parse(JSON.stringify(this.checkList));\n      this.dishTable.forEach(function (n) {\n        n.copies = 1;\n      });\n      this.dialogVisible = false;\n    }\n  }, {\n    key: \"submitForm\",\n    value: function submitForm(formName, st) {\n      var _this4 = this;\n\n      ;\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          if (_this4.dishTable.length === 0) {\n            return _this4.$message.error('套餐下菜品不能为空');\n          }\n\n          if (!_this4.ruleForm.image) return _this4.$message.error('套餐图片不能为空');\n\n          var prams = _objectSpread({}, _this4.ruleForm);\n\n          prams.setmealDishes = _this4.dishTable.map(function (obj) {\n            return {\n              copies: obj.copies,\n              dishId: obj.dishId,\n              name: obj.name,\n              price: obj.price\n            };\n          });\n          prams.status = _this4.actionType === 'add' ? 0 : _this4.ruleForm.status ? 1 : 0;\n          prams.categoryId = _this4.ruleForm.idType; // delete prams.dishList\n\n          if (_this4.actionType == 'add') {\n            delete prams.id;\n            (0, _setMeal.addSetmeal)(prams).then(function (res) {\n              if (res && res.data && res.data.code === 200) {\n                _this4.$message.success('套餐添加成功！');\n\n                if (!st) {\n                  _this4.$router.push({\n                    path: '/setmeal'\n                  });\n                } else {\n                  ;\n\n                  _this4.$refs.ruleForm.resetFields();\n\n                  _this4.dishList = [];\n                  _this4.dishTable = [];\n                  _this4.ruleForm = {\n                    name: '',\n                    categoryId: '',\n                    price: '',\n                    code: '',\n                    image: '',\n                    description: '',\n                    dishList: [],\n                    status: true,\n                    id: '',\n                    idType: ''\n                  };\n                  _this4.imageUrl = '';\n                }\n              } else {\n                _this4.$message.error(res.data.msg);\n              }\n            }).catch(function (err) {\n              _this4.$message.error('请求出错了：' + err.message);\n            });\n          } else {\n            delete prams.updateTime;\n            (0, _setMeal.editSetmeal)(prams).then(function (res) {\n              if (res.data.code === 200) {\n                _this4.$message.success('套餐修改成功！');\n\n                _this4.$router.push({\n                  path: '/setmeal'\n                });\n              } else {// this.$message.error(res.data.desc || res.data.message)\n              }\n            }).catch(function (err) {\n              _this4.$message.error('请求出错了：' + err.message);\n            });\n          }\n        } else {\n          // console.log('error submit!!')\n          return false;\n        }\n      });\n    }\n  }, {\n    key: \"imageChange\",\n    value: function imageChange(value) {\n      this.ruleForm.image = value;\n    }\n  }, {\n    key: \"rules\",\n    get: function get() {\n      return {\n        name: {\n          required: true,\n          validator: function validator(rule, value, callback) {\n            if (!value) {\n              callback(new Error('请输入套餐名称'));\n            } else {\n              var reg = /^([A-Za-z0-9\\u4e00-\\u9fa5]){2,20}$/;\n\n              if (!reg.test(value)) {\n                callback(new Error('套餐名称输入不符，请输入2-20个字符'));\n              } else {\n                callback();\n              }\n            }\n          },\n          trigger: 'blur'\n        },\n        idType: {\n          required: true,\n          message: '请选择套餐分类',\n          trigger: 'change'\n        },\n        image: {\n          required: true,\n          message: '菜品图片不能为空'\n        },\n        price: {\n          required: true,\n          // 'message': '请输入套餐价格',\n          validator: function validator(rules, value, callback) {\n            var reg = /^([1-9]\\d{0,5}|0)(\\.\\d{1,2})?$/;\n\n            if (!reg.test(value) || Number(value) <= 0) {\n              callback(new Error('套餐价格格式有误，请输入大于零且最多保留两位小数的金额'));\n            } else {\n              callback();\n            }\n          },\n          trigger: 'blur'\n        },\n        code: {\n          required: true,\n          message: '请输入商品码',\n          trigger: 'blur'\n        }\n      };\n    }\n  }]);\n  return default_1;\n}(_vuePropertyDecorator.Vue);\n\ndefault_1 = (0, _tslib.__decorate)([(0, _vuePropertyDecorator.Component)({\n  name: 'addShop',\n  components: {\n    HeadLable: _index.default,\n    AddDish: _AddDish.default,\n    ImageUpload: _index2.default\n  }\n})], default_1);\nvar _default = default_1;\nexports.default = _default;",{"version":3,"sources":["/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/huoxiyi/IdeaProjects/MissuoFrontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huoxiyi/IdeaProjects/MissuoFrontend/src/views/setmeal/addSetmeal.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue } from 'vue-property-decorator'\nimport HeadLable from '@/components/HeadLable/index.vue'\nimport ImageUpload from '@/components/ImgUpload/index.vue'\nimport AddDish from './components/AddDish.vue'\nimport { querySetmealById, addSetmeal, editSetmeal } from '@/api/setMeal'\nimport { getCategoryList } from '@/api/dish'\nimport { baseUrl } from '@/config.json'\n\n@Component({\n  name: 'addShop',\n  components: {\n    HeadLable,\n    AddDish,\n    ImageUpload\n  }\n})\nexport default class extends Vue {\n  private value: string = ''\n  private setMealList: [] = []\n  private seachKey: string = ''\n  private dishList: [] = []\n  private imageUrl: string = ''\n  private actionType: string = ''\n  private dishTable: [] = []\n  private dialogVisible: boolean = false\n  private checkList: any[] = []\n  private ruleForm = {\n    name: '',\n    categoryId: '',\n    price: '',\n    code: '',\n    image: '',\n    description: '',\n    dishList: [],\n    status: true,\n    idType: ''\n  }\n\n  get rules() {\n    return {\n      name: {\n        required: true,\n        validator: (rule: any, value: string, callback: Function) => {\n          if (!value) {\n            callback(new Error('请输入套餐名称'))\n          } else {\n            const reg = /^([A-Za-z0-9\\u4e00-\\u9fa5]){2,20}$/\n            if (!reg.test(value)) {\n              callback(new Error('套餐名称输入不符，请输入2-20个字符'))\n            } else {\n              callback()\n            }\n          }\n        },\n        trigger: 'blur'\n      },\n      idType: {\n        required: true,\n        message: '请选择套餐分类',\n        trigger: 'change'\n      },\n      image: {\n        required: true,\n        message: '菜品图片不能为空'\n      },\n      price: {\n        required: true,\n        // 'message': '请输入套餐价格',\n        validator: (rules: any, value: string, callback: Function) => {\n          const reg = /^([1-9]\\d{0,5}|0)(\\.\\d{1,2})?$/\n          if (!reg.test(value) || Number(value) <= 0) {\n            callback(\n              new Error(\n                '套餐价格格式有误，请输入大于零且最多保留两位小数的金额'\n              )\n            )\n          } else {\n            callback()\n          }\n        },\n        trigger: 'blur'\n      },\n      code: { required: true, message: '请输入商品码', trigger: 'blur' }\n    }\n  }\n\n  created() {\n    this.getDishTypeList()\n    this.actionType = this.$route.query.id ? 'edit' : 'add'\n    if (this.actionType == 'edit') {\n      this.init()\n    }\n  }\n\n  private async init() {\n    querySetmealById(this.$route.query.id).then(res => {\n      if (res && res.data && res.data.code === 200) {\n        this.ruleForm = res.data.data\n        this.ruleForm.status = res.data.data.status == '1'\n        ;(this.ruleForm as any).price = res.data.data.price\n        // this.imageUrl = `http://172.17.2.120:8080/common/download?name=${res.data.data.image}`\n        this.imageUrl = res.data.data.image\n        this.checkList = res.data.data.setmealDishes\n        this.dishTable = res.data.data.setmealDishes.reverse()\n        this.ruleForm.idType = res.data.data.categoryId\n      } else {\n        this.$message.error(res.data.msg)\n      }\n    })\n  }\n  private seachHandle() {\n    this.seachKey = this.value\n  }\n  // 获取套餐分类\n  private getDishTypeList() {\n    getCategoryList({ type: 2, page: 1, pageSize: 1000 }).then(res => {\n      if (res && res.data && res.data.code === 200) {\n        this.setMealList = res.data.data.map((obj: any) => ({\n          ...obj,\n          idType: obj.id\n        }))\n      } else {\n        this.$message.error(res.data.msg)\n      }\n    })\n  }\n\n  // 通过套餐ID获取菜品列表分类\n  // private getDishList (id:number) {\n  //   getDishListType({id}).then(res => {\n  //     if (res.data.code == 200) {\n  //       const { data } = res.data\n  //       this.dishList = data\n  //     } else {\n  //       this.$message.error(res.data.desc)\n  //     }\n  //   })\n  // }\n\n  // 删除套餐菜品\n  delDishHandle(index: any) {\n    this.dishTable.splice(index, 1)\n    this.checkList = this.dishTable\n    // this.checkList.splice(index, 1)\n  }\n\n  // 获取添加菜品数据 - 确定加菜倒序展示\n  private getCheckList(value: any) {\n    this.checkList = [...value].reverse()\n  }\n\n  // 添加菜品\n  openAddDish(st: string) {\n    this.seachKey = ''\n    this.dialogVisible = true\n  }\n  // 取消添加菜品\n  handleClose(done: any) {\n    // this.$refs.adddish.close()\n    this.dialogVisible = false\n    this.checkList = JSON.parse(JSON.stringify(this.dishTable))\n    // this.dialogVisible = false\n  }\n\n  // 保存添加菜品列表\n  public addTableList() {\n    this.dishTable = JSON.parse(JSON.stringify(this.checkList))\n    this.dishTable.forEach((n: any) => {\n      n.copies = 1\n    })\n    this.dialogVisible = false\n  }\n\n  public submitForm(formName: any, st: any) {\n    ;(this.$refs[formName] as any).validate((valid: any) => {\n      if (valid) {\n        if (this.dishTable.length === 0) {\n          return this.$message.error('套餐下菜品不能为空')\n        }\n        if (!this.ruleForm.image) return this.$message.error('套餐图片不能为空')\n        let prams = { ...this.ruleForm } as any\n        prams.setmealDishes = this.dishTable.map((obj: any) => ({\n          copies: obj.copies,\n          dishId: obj.dishId,\n          name: obj.name,\n          price: obj.price\n        }))\n        ;(prams as any).status =\n          this.actionType === 'add' ? 0 : this.ruleForm.status ? 1 : 0\n        prams.categoryId = this.ruleForm.idType\n        // delete prams.dishList\n        if (this.actionType == 'add') {\n          delete prams.id\n          addSetmeal(prams)\n            .then(res => {\n              if (res && res.data && res.data.code === 200) {\n                this.$message.success('套餐添加成功！')\n                if (!st) {\n                  this.$router.push({ path: '/setmeal' })\n                } else {\n                  ;(this as any).$refs.ruleForm.resetFields()\n                  this.dishList = []\n                  this.dishTable = []\n                  this.ruleForm = {\n                    name: '',\n                    categoryId: '',\n                    price: '',\n                    code: '',\n                    image: '',\n                    description: '',\n                    dishList: [],\n                    status: true,\n                    id: '',\n                    idType: ''\n                  } as any\n                  this.imageUrl = ''\n                }\n              } else {\n                this.$message.error(res.data.msg)\n              }\n            })\n            .catch(err => {\n              this.$message.error('请求出错了：' + err.message)\n            })\n        } else {\n          delete prams.updateTime\n          editSetmeal(prams)\n            .then(res => {\n              if (res.data.code === 200) {\n                this.$message.success('套餐修改成功！')\n                this.$router.push({ path: '/setmeal' })\n              } else {\n                // this.$message.error(res.data.desc || res.data.message)\n              }\n            })\n            .catch(err => {\n              this.$message.error('请求出错了：' + err.message)\n            })\n        }\n      } else {\n        // console.log('error submit!!')\n        return false\n      }\n    })\n  }\n\n  imageChange(value: any) {\n    this.ruleForm.image = value\n  }\n}\n"],"sourceRoot":""}]}